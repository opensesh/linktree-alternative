module.exports=[33354,(a,b,c)=>{"use strict";c._=function(a){return a&&a.__esModule?a:{default:a}}},46058,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},92966,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HeadManagerContext},30089,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"setAttributesFromProps",{enumerable:!0,get:function(){return g}});let d={acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv",noModule:"noModule"},e=["onLoad","onReady","dangerouslySetInnerHTML","children","onError","strategy","stylesheets"];function f(a){return["async","defer","noModule"].includes(a)}function g(a,b){for(let[c,g]of Object.entries(b)){if(!b.hasOwnProperty(c)||e.includes(c)||void 0===g)continue;let h=d[c]||c.toLowerCase();"SCRIPT"===a.tagName&&f(h)?a[h]=!!g:a.setAttribute(h,String(g)),(!1===g||"SCRIPT"===a.tagName&&f(h)&&(!g||"false"===g))&&(a.setAttribute(h,""),a.removeAttribute(h))}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},12962,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={cancelIdleCallback:function(){return g},requestIdleCallback:function(){return f}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="u">typeof self&&self.requestIdleCallback&&self.requestIdleCallback.bind(window)||function(a){let b=Date.now();return self.setTimeout(function(){a({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-b))}})},1)},g="u">typeof self&&self.cancelIdleCallback&&self.cancelIdleCallback.bind(window)||function(a){return clearTimeout(a)};("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},96665,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return t},handleClientScriptLoad:function(){return q},initScriptLoader:function(){return r}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(33354),g=a.r(46058),h=a.r(87924),i=f._(a.r(35112)),j=g._(a.r(72131)),k=a.r(92966),l=a.r(30089),m=a.r(12962),n=new Map,o=new Set,p=a=>{let{src:b,id:c,onLoad:d=()=>{},onReady:e=null,dangerouslySetInnerHTML:f,children:g="",strategy:h="afterInteractive",onError:j,stylesheets:k}=a,m=c||b;if(m&&o.has(m))return;if(n.has(b)){o.add(m),n.get(b).then(d,j);return}let p=()=>{e&&e(),o.add(m)},q=document.createElement("script"),r=new Promise((a,b)=>{q.addEventListener("load",function(b){a(),d&&d.call(this,b),p()}),q.addEventListener("error",function(a){b(a)})}).catch(function(a){j&&j(a)});f?(q.innerHTML=f.__html||"",p()):g?(q.textContent="string"==typeof g?g:Array.isArray(g)?g.join(""):"",p()):b&&(q.src=b,n.set(b,r)),(0,l.setAttributesFromProps)(q,a),"worker"===h&&q.setAttribute("type","text/partytown"),q.setAttribute("data-nscript",h),k&&(a=>{if(i.default.preinit)return a.forEach(a=>{i.default.preinit(a,{as:"style"})})})(k),document.body.appendChild(q)};function q(a){let{strategy:b="afterInteractive"}=a;"lazyOnload"===b?window.addEventListener("load",()=>{(0,m.requestIdleCallback)(()=>p(a))}):p(a)}function r(a){a.forEach(q),[...document.querySelectorAll('[data-nscript="beforeInteractive"]'),...document.querySelectorAll('[data-nscript="beforePageRender"]')].forEach(a=>{let b=a.id||a.getAttribute("src");o.add(b)})}function s(a){let{id:b,src:c="",onLoad:d=()=>{},onReady:e=null,strategy:f="afterInteractive",onError:g,stylesheets:l,...n}=a,{updateScripts:q,scripts:r,getIsSsr:s,appDir:t,nonce:u}=(0,j.useContext)(k.HeadManagerContext);u=n.nonce||u;let v=(0,j.useRef)(!1);(0,j.useEffect)(()=>{let a=b||c;v.current||(e&&a&&o.has(a)&&e(),v.current=!0)},[e,b,c]);let w=(0,j.useRef)(!1);if((0,j.useEffect)(()=>{if(!w.current){if("afterInteractive"===f)p(a);else"lazyOnload"===f&&("complete"===document.readyState?(0,m.requestIdleCallback)(()=>p(a)):window.addEventListener("load",()=>{(0,m.requestIdleCallback)(()=>p(a))}));w.current=!0}},[a,f]),("beforeInteractive"===f||"worker"===f)&&(q?(r[f]=(r[f]||[]).concat([{id:b,src:c,onLoad:d,onReady:e,onError:g,...n,nonce:u}]),q(r)):s&&s()?o.add(b||c):s&&!s()&&p({...a,nonce:u})),t){if(l&&l.forEach(a=>{i.default.preinit(a,{as:"style"})}),"beforeInteractive"===f)if(!c)return n.dangerouslySetInnerHTML&&(n.children=n.dangerouslySetInnerHTML.__html,delete n.dangerouslySetInnerHTML),(0,h.jsx)("script",{nonce:u,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([0,{...n,id:b}])})`}});else return i.default.preload(c,n.integrity?{as:"script",integrity:n.integrity,nonce:u,crossOrigin:n.crossOrigin}:{as:"script",nonce:u,crossOrigin:n.crossOrigin}),(0,h.jsx)("script",{nonce:u,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([c,{...n,id:b}])})`}});"afterInteractive"===f&&c&&i.default.preload(c,n.integrity?{as:"script",integrity:n.integrity,nonce:u,crossOrigin:n.crossOrigin}:{as:"script",nonce:u,crossOrigin:n.crossOrigin})}return null}Object.defineProperty(s,"__nextScript",{value:!0});let t=s;("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},22575,a=>{"use strict";let b,c,d;var e=a.i(87924);function f(a){let b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)}function g(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a}function h(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a}function i(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a}function j(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a}function k(a){let b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d}function l(a,b){let c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f)),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f,a}function m(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function n(a,b,c){let d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a}let o=(b=[0,0,0],c=[0,0,0],function(a,d){g(b,a),g(c,d),l(b,b),l(c,c);let e=m(b,c);return e>1?0:e<-1?Math.PI:Math.acos(e)});class p extends Array{constructor(a=0,b=a,c=a){return super(a,b,c),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(a){this[0]=a}set y(a){this[1]=a}set z(a){this[2]=a}set(a,b=a,c=a){return a.length?this.copy(a):(this[0]=a,this[1]=b,this[2]=c,this)}copy(a){return g(this,a),this}add(a,b){return b?h(this,a,b):h(this,this,a),this}sub(a,b){return b?i(this,a,b):i(this,this,a),this}multiply(a){if(a.length)this[0]=this[0]*a[0],this[1]=this[1]*a[1],this[2]=this[2]*a[2];else j(this,this,a);return this}divide(a){if(a.length)this[0]=this[0]/a[0],this[1]=this[1]/a[1],this[2]=this[2]/a[2];else j(this,this,1/a);return this}inverse(a=this){return this[0]=1/a[0],this[1]=1/a[1],this[2]=1/a[2],this}len(){return f(this)}distance(a){let b,c,d;if(!a)return f(this);return b=a[0]-this[0],Math.sqrt(b*b+(c=a[1]-this[1])*c+(d=a[2]-this[2])*d)}squaredLen(){return k(this)}squaredDistance(a){let b,c,d;if(!a)return k(this);return b=a[0]-this[0],b*b+(c=a[1]-this[1])*c+(d=a[2]-this[2])*d}negate(a=this){return this[0]=-a[0],this[1]=-a[1],this[2]=-a[2],this}cross(a,b){return b?n(this,a,b):n(this,this,a),this}scale(a){return j(this,this,a),this}normalize(){return l(this,this),this}dot(a){return m(this,a)}equals(a){return this[0]===a[0]&&this[1]===a[1]&&this[2]===a[2]}applyMatrix3(a){let b,c,d;return b=this[0],c=this[1],d=this[2],this[0]=b*a[0]+c*a[3]+d*a[6],this[1]=b*a[1]+c*a[4]+d*a[7],this[2]=b*a[2]+c*a[5]+d*a[8],this}applyMatrix4(a){let b,c,d,e;return b=this[0],c=this[1],d=this[2],e=(e=a[3]*b+a[7]*c+a[11]*d+a[15])||1,this[0]=(a[0]*b+a[4]*c+a[8]*d+a[12])/e,this[1]=(a[1]*b+a[5]*c+a[9]*d+a[13])/e,this[2]=(a[2]*b+a[6]*c+a[10]*d+a[14])/e,this}scaleRotateMatrix4(a){let b,c,d,e;return b=this[0],c=this[1],d=this[2],e=(e=a[3]*b+a[7]*c+a[11]*d+a[15])||1,this[0]=(a[0]*b+a[4]*c+a[8]*d)/e,this[1]=(a[1]*b+a[5]*c+a[9]*d)/e,this[2]=(a[2]*b+a[6]*c+a[10]*d)/e,this}applyQuaternion(a){let b,c,d,e,f,g,h,i,j,k,l,m,n,o;return b=this[0],c=this[1],d=this[2],e=a[0],f=a[1],g=a[2],h=a[3],i=f*d-g*c,j=g*b-e*d,k=e*c-f*b,l=f*k-g*j,m=g*i-e*k,n=e*j-f*i,i*=o=2*h,j*=o,k*=o,l*=2,m*=2,n*=2,this[0]=b+i+l,this[1]=c+j+m,this[2]=d+k+n,this}angle(a){return o(this,a)}lerp(a,b){let c,d,e;return c=this[0],d=this[1],e=this[2],this[0]=c+b*(a[0]-c),this[1]=d+b*(a[1]-d),this[2]=e+b*(a[2]-e),this}smoothLerp(a,b,c){let d,e,f,g;return d=Math.exp(-b*c),e=this[0],f=this[1],g=this[2],this[0]=a[0]+(e-a[0])*d,this[1]=a[1]+(f-a[1])*d,this[2]=a[2]+(g-a[2])*d,this}clone(){return new p(this[0],this[1],this[2])}fromArray(a,b=0){return this[0]=a[b],this[1]=a[b+1],this[2]=a[b+2],this}toArray(a=[],b=0){return a[b]=this[0],a[b+1]=this[1],a[b+2]=this[2],a}transformDirection(a){let b=this[0],c=this[1],d=this[2];return this[0]=a[0]*b+a[4]*c+a[8]*d,this[1]=a[1]*b+a[5]*c+a[9]*d,this[2]=a[2]*b+a[6]*c+a[10]*d,this.normalize()}}let q=new p,r=1;class s{constructor({canvas:a=document.createElement("canvas"),width:b=300,height:c=150,dpr:d=1,alpha:e=!1,depth:f=!0,stencil:g=!1,antialias:h=!1,premultipliedAlpha:i=!1,preserveDrawingBuffer:j=!1,powerPreference:k="default",autoClear:l=!0,webgl:m=2}={}){const n={alpha:e,depth:f,stencil:g,antialias:h,premultipliedAlpha:i,preserveDrawingBuffer:j,powerPreference:k};this.dpr=d,this.alpha=e,this.color=!0,this.depth=f,this.stencil=g,this.premultipliedAlpha=i,this.autoClear=l,this.id=r++,2===m&&(this.gl=a.getContext("webgl2",n)),this.isWebgl2=!!this.gl,this.gl||(this.gl=a.getContext("webgl",n)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(b,c),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=!1,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LEQUAL,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.state.currentProgram=null,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.getExtension("WEBGL_compressed_texture_astc"),this.getExtension("EXT_texture_compression_bptc"),this.getExtension("WEBGL_compressed_texture_s3tc"),this.getExtension("WEBGL_compressed_texture_etc1"),this.getExtension("WEBGL_compressed_texture_pvrtc"),this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(a,b){this.width=a,this.height=b,this.gl.canvas.width=a*this.dpr,this.gl.canvas.height=b*this.dpr,this.gl.canvas.style&&Object.assign(this.gl.canvas.style,{width:a+"px",height:b+"px"})}setViewport(a,b,c=0,d=0){(this.state.viewport.width!==a||this.state.viewport.height!==b)&&(this.state.viewport.width=a,this.state.viewport.height=b,this.state.viewport.x=c,this.state.viewport.y=d,this.gl.viewport(c,d,a,b))}setScissor(a,b,c=0,d=0){this.gl.scissor(c,d,a,b)}enable(a){!0!==this.state[a]&&(this.gl.enable(a),this.state[a]=!0)}disable(a){!1!==this.state[a]&&(this.gl.disable(a),this.state[a]=!1)}setBlendFunc(a,b,c,d){(this.state.blendFunc.src!==a||this.state.blendFunc.dst!==b||this.state.blendFunc.srcAlpha!==c||this.state.blendFunc.dstAlpha!==d)&&(this.state.blendFunc.src=a,this.state.blendFunc.dst=b,this.state.blendFunc.srcAlpha=c,this.state.blendFunc.dstAlpha=d,void 0!==c?this.gl.blendFuncSeparate(a,b,c,d):this.gl.blendFunc(a,b))}setBlendEquation(a,b){a=a||this.gl.FUNC_ADD,(this.state.blendEquation.modeRGB!==a||this.state.blendEquation.modeAlpha!==b)&&(this.state.blendEquation.modeRGB=a,this.state.blendEquation.modeAlpha=b,void 0!==b?this.gl.blendEquationSeparate(a,b):this.gl.blendEquation(a))}setCullFace(a){this.state.cullFace!==a&&(this.state.cullFace=a,this.gl.cullFace(a))}setFrontFace(a){this.state.frontFace!==a&&(this.state.frontFace=a,this.gl.frontFace(a))}setDepthMask(a){this.state.depthMask!==a&&(this.state.depthMask=a,this.gl.depthMask(a))}setDepthFunc(a){this.state.depthFunc!==a&&(this.state.depthFunc=a,this.gl.depthFunc(a))}setStencilMask(a){this.state.stencilMask!==a&&(this.state.stencilMask=a,this.gl.stencilMask(a))}setStencilFunc(a,b,c){(this.state.stencilFunc!==a||this.state.stencilRef!==b||this.state.stencilFuncMask!==c)&&(this.state.stencilFunc=a||this.gl.ALWAYS,this.state.stencilRef=b||0,this.state.stencilFuncMask=c||0,this.gl.stencilFunc(a||this.gl.ALWAYS,b||0,c||0))}setStencilOp(a,b,c){(this.state.stencilFail!==a||this.state.stencilDepthFail!==b||this.state.stencilDepthPass!==c)&&(this.state.stencilFail=a,this.state.stencilDepthFail=b,this.state.stencilDepthPass=c,this.gl.stencilOp(a,b,c))}activeTexture(a){this.state.activeTextureUnit!==a&&(this.state.activeTextureUnit=a,this.gl.activeTexture(this.gl.TEXTURE0+a))}bindFramebuffer({target:a=this.gl.FRAMEBUFFER,buffer:b=null}={}){this.state.framebuffer!==b&&(this.state.framebuffer=b,this.gl.bindFramebuffer(a,b))}getExtension(a,b,c){return b&&this.gl[b]?this.gl[b].bind(this.gl):(this.extensions[a]||(this.extensions[a]=this.gl.getExtension(a)),b)?this.extensions[a]?this.extensions[a][c].bind(this.extensions[a]):null:this.extensions[a]}sortOpaque(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.program.id!==b.program.id?a.program.id-b.program.id:a.zDepth!==b.zDepth?a.zDepth-b.zDepth:b.id-a.id}sortTransparent(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.zDepth!==b.zDepth?b.zDepth-a.zDepth:b.id-a.id}sortUI(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.program.id!==b.program.id?a.program.id-b.program.id:b.id-a.id}getRenderList({scene:a,camera:b,frustumCull:c,sort:d}){let e=[];if(b&&c&&b.updateFrustum(),a.traverse(a=>!a.visible||(a.draw?void((!c||!a.frustumCulled||!b||b.frustumIntersectsMesh(a))&&e.push(a)):void 0)),d){let a=[],c=[],d=[];e.forEach(e=>{e.program.transparent?e.program.depthTest?c.push(e):d.push(e):a.push(e),e.zDepth=0,0===e.renderOrder&&e.program.depthTest&&b&&(e.worldMatrix.getTranslation(q),q.applyMatrix4(b.projectionViewMatrix),e.zDepth=q.z)}),a.sort(this.sortOpaque),c.sort(this.sortTransparent),d.sort(this.sortUI),e=a.concat(c,d)}return e}render({scene:a,camera:b,target:c=null,update:d=!0,sort:e=!0,frustumCull:f=!0,clear:g}){null===c?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(c),this.setViewport(c.width,c.height)),(g||this.autoClear&&!1!==g)&&(this.depth&&(!c||c.depth)&&(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),(this.stencil||!c||c.stencil)&&(this.enable(this.gl.STENCIL_TEST),this.setStencilMask(255)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),d&&a.updateMatrixWorld(),b&&b.updateMatrixWorld(),this.getRenderList({scene:a,camera:b,frustumCull:f,sort:e}).forEach(a=>{a.draw({camera:b})})}}let t=1,u={};class v{constructor(a,{vertex:b,fragment:c,uniforms:d={},transparent:e=!1,cullFace:f=a.BACK,frontFace:g=a.CCW,depthTest:h=!0,depthWrite:i=!0,depthFunc:j=a.LEQUAL}={}){a.canvas||console.error("gl not passed as first argument to Program"),this.gl=a,this.uniforms=d,this.id=t++,b||console.warn("vertex shader not supplied"),c||console.warn("fragment shader not supplied"),this.transparent=e,this.cullFace=f,this.frontFace=g,this.depthTest=h,this.depthWrite=i,this.depthFunc=j,this.blendFunc={},this.blendEquation={},this.stencilFunc={},this.stencilOp={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)),this.vertexShader=a.createShader(a.VERTEX_SHADER),this.fragmentShader=a.createShader(a.FRAGMENT_SHADER),this.program=a.createProgram(),a.attachShader(this.program,this.vertexShader),a.attachShader(this.program,this.fragmentShader),this.setShaders({vertex:b,fragment:c})}setShaders({vertex:a,fragment:b}){if(a&&(this.gl.shaderSource(this.vertexShader,a),this.gl.compileShader(this.vertexShader),""!==this.gl.getShaderInfoLog(this.vertexShader)&&console.warn(`${this.gl.getShaderInfoLog(this.vertexShader)}
Vertex Shader
${x(a)}`)),b&&(this.gl.shaderSource(this.fragmentShader,b),this.gl.compileShader(this.fragmentShader),""!==this.gl.getShaderInfoLog(this.fragmentShader)&&console.warn(`${this.gl.getShaderInfoLog(this.fragmentShader)}
Fragment Shader
${x(b)}`)),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))return console.warn(this.gl.getProgramInfoLog(this.program));this.uniformLocations=new Map;let c=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS);for(let a=0;a<c;a++){let b=this.gl.getActiveUniform(this.program,a);this.uniformLocations.set(b,this.gl.getUniformLocation(this.program,b.name));let c=b.name.match(/(\w+)/g);b.uniformName=c[0],b.nameComponents=c.slice(1)}this.attributeLocations=new Map;let d=[],e=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES);for(let a=0;a<e;a++){let b=this.gl.getActiveAttrib(this.program,a),c=this.gl.getAttribLocation(this.program,b.name);-1!==c&&(d[c]=b.name,this.attributeLocations.set(b,c))}this.attributeOrder=d.join("")}setBlendFunc(a,b,c,d){this.blendFunc.src=a,this.blendFunc.dst=b,this.blendFunc.srcAlpha=c,this.blendFunc.dstAlpha=d,a&&(this.transparent=!0)}setBlendEquation(a,b){this.blendEquation.modeRGB=a,this.blendEquation.modeAlpha=b}setStencilFunc(a,b,c){this.stencilRef=b,this.stencilFunc.func=a,this.stencilFunc.ref=b,this.stencilFunc.mask=c}setStencilOp(a,b,c){this.stencilOp.stencilFail=a,this.stencilOp.depthFail=b,this.stencilOp.depthPass=c}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha),this.stencilFunc.func||this.stencilOp.stencilFail?this.gl.renderer.enable(this.gl.STENCIL_TEST):this.gl.renderer.disable(this.gl.STENCIL_TEST),this.gl.renderer.setStencilFunc(this.stencilFunc.func,this.stencilFunc.ref,this.stencilFunc.mask),this.gl.renderer.setStencilOp(this.stencilOp.stencilFail,this.stencilOp.depthFail,this.stencilOp.depthPass)}use({flipFaces:a=!1}={}){let b=-1;this.gl.renderer.state.currentProgram!==this.id&&(this.gl.useProgram(this.program),this.gl.renderer.state.currentProgram=this.id),this.uniformLocations.forEach((a,c)=>{let d=this.uniforms[c.uniformName];for(let a of c.nameComponents){if(!d)break;if(a in d)d=d[a];else if(Array.isArray(d.value))break;else{d=void 0;break}}if(!d)return z(`Active uniform ${c.name} has not been supplied`);if(d&&void 0===d.value)return z(`${c.name} uniform is missing a value parameter`);if(d.value.texture)return b+=1,d.value.update(b),w(this.gl,c.type,a,b);if(d.value.length&&d.value[0].texture){let e=[];return d.value.forEach(a=>{b+=1,a.update(b),e.push(b)}),w(this.gl,c.type,a,e)}w(this.gl,c.type,a,d.value)}),this.applyState(),a&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function w(a,b,c,d){d=d.length?function(a){let b=a.length,c=a[0].length;if(void 0===c)return a;let d=b*c,e=u[d];e||(u[d]=e=new Float32Array(d));for(let d=0;d<b;d++)e.set(a[d],d*c);return e}(d):d;let e=a.renderer.state.uniformLocations.get(c);if(d.length)if(void 0===e||e.length!==d.length)a.renderer.state.uniformLocations.set(c,d.slice(0));else{if(function(a,b){if(a.length!==b.length)return!1;for(let c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;return!0}(e,d))return;e.set?e.set(d):function(a,b){for(let c=0,d=a.length;c<d;c++)a[c]=b[c]}(e,d),a.renderer.state.uniformLocations.set(c,e)}else{if(e===d)return;a.renderer.state.uniformLocations.set(c,d)}switch(b){case 5126:return d.length?a.uniform1fv(c,d):a.uniform1f(c,d);case 35664:return a.uniform2fv(c,d);case 35665:return a.uniform3fv(c,d);case 35666:return a.uniform4fv(c,d);case 35670:case 5124:case 35678:case 36306:case 35680:case 36289:return d.length?a.uniform1iv(c,d):a.uniform1i(c,d);case 35671:case 35667:return a.uniform2iv(c,d);case 35672:case 35668:return a.uniform3iv(c,d);case 35673:case 35669:return a.uniform4iv(c,d);case 35674:return a.uniformMatrix2fv(c,!1,d);case 35675:return a.uniformMatrix3fv(c,!1,d);case 35676:return a.uniformMatrix4fv(c,!1,d)}}function x(a){let b=a.split("\n");for(let a=0;a<b.length;a++)b[a]=a+1+": "+b[a];return b.join("\n")}let y=0;function z(a){!(y>100)&&(console.warn(a),++y>100&&console.warn("More than 100 program warnings - stopping logs."))}function A(a,b,c){let d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a}let B=function(a,b){let c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g)),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g,a};class C extends Array{constructor(a=0,b=0,c=0,d=1){super(a,b,c,d),this.onChange=()=>{},this._target=this;const e=["0","1","2","3"];return new Proxy(this,{set(a,b){let c=Reflect.set(...arguments);return c&&e.includes(b)&&a.onChange(),c}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(a){this._target[0]=a,this.onChange()}set y(a){this._target[1]=a,this.onChange()}set z(a){this._target[2]=a,this.onChange()}set w(a){this._target[3]=a,this.onChange()}identity(){var a;return(a=this._target)[0]=0,a[1]=0,a[2]=0,a[3]=1,this.onChange(),this}set(a,b,c,d){var e;return a.length?this.copy(a):(e=this._target,e[0]=a,e[1]=b,e[2]=c,e[3]=d,this.onChange(),this)}rotateX(a){var b,c,d;let e,f,g,h,i,j;return b=this._target,c=this._target,d=.5*a,e=c[0],f=c[1],g=c[2],h=c[3],i=Math.sin(d),j=Math.cos(d),b[0]=e*j+h*i,b[1]=f*j+g*i,b[2]=g*j-f*i,b[3]=h*j-e*i,this.onChange(),this}rotateY(a){var b,c,d;let e,f,g,h,i,j;return b=this._target,c=this._target,d=.5*a,e=c[0],f=c[1],g=c[2],h=c[3],i=Math.sin(d),j=Math.cos(d),b[0]=e*j-g*i,b[1]=f*j+h*i,b[2]=g*j+e*i,b[3]=h*j-f*i,this.onChange(),this}rotateZ(a){var b,c,d;let e,f,g,h,i,j;return b=this._target,c=this._target,d=.5*a,e=c[0],f=c[1],g=c[2],h=c[3],i=Math.sin(d),j=Math.cos(d),b[0]=e*j+f*i,b[1]=f*j-e*i,b[2]=g*j+h*i,b[3]=h*j-g*i,this.onChange(),this}inverse(a=this._target){var b;let c,d,e,f,g,h;return b=this._target,c=a[0],d=a[1],h=(g=c*c+d*d+(e=a[2])*e+(f=a[3])*f)?1/g:0,b[0]=-c*h,b[1]=-d*h,b[2]=-e*h,b[3]=f*h,this.onChange(),this}conjugate(a=this._target){var b;return b=this._target,b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=a[3],this.onChange(),this}copy(a){var b;return b=this._target,b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],this.onChange(),this}normalize(a=this._target){return B(this._target,a),this.onChange(),this}multiply(a,b){return b?A(this._target,a,b):A(this._target,this._target,a),this.onChange(),this}dot(a){var b;return b=this._target,b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]*a[3]}fromMatrix3(a){return!function(a,b){let c,d=b[0]+b[4]+b[8];if(d>0)c=Math.sqrt(d+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{let d=0;b[4]>b[0]&&(d=1),b[8]>b[3*d+d]&&(d=2);let e=(d+1)%3,f=(d+2)%3;c=Math.sqrt(b[3*d+d]-b[3*e+e]-b[3*f+f]+1),a[d]=.5*c,c=.5/c,a[3]=(b[3*e+f]-b[3*f+e])*c,a[e]=(b[3*e+d]+b[3*d+e])*c,a[f]=(b[3*f+d]+b[3*d+f])*c}}(this._target,a),this.onChange(),this}fromEuler(a,b){return!function(a,b,c="YXZ"){let d=Math.sin(.5*b[0]),e=Math.cos(.5*b[0]),f=Math.sin(.5*b[1]),g=Math.cos(.5*b[1]),h=Math.sin(.5*b[2]),i=Math.cos(.5*b[2]);"XYZ"===c?(a[0]=d*g*i+e*f*h,a[1]=e*f*i-d*g*h,a[2]=e*g*h+d*f*i,a[3]=e*g*i-d*f*h):"YXZ"===c?(a[0]=d*g*i+e*f*h,a[1]=e*f*i-d*g*h,a[2]=e*g*h-d*f*i,a[3]=e*g*i+d*f*h):"ZXY"===c?(a[0]=d*g*i-e*f*h,a[1]=e*f*i+d*g*h,a[2]=e*g*h+d*f*i,a[3]=e*g*i-d*f*h):"ZYX"===c?(a[0]=d*g*i-e*f*h,a[1]=e*f*i+d*g*h,a[2]=e*g*h-d*f*i,a[3]=e*g*i+d*f*h):"YZX"===c?(a[0]=d*g*i+e*f*h,a[1]=e*f*i+d*g*h,a[2]=e*g*h-d*f*i,a[3]=e*g*i-d*f*h):"XZY"===c&&(a[0]=d*g*i-e*f*h,a[1]=e*f*i-d*g*h,a[2]=e*g*h+d*f*i,a[3]=e*g*i+d*f*h)}(this._target,a,a.order),b||this.onChange(),this}fromAxisAngle(a,b){var c,d;let e;return c=this._target,e=Math.sin(d=.5*b),c[0]=e*a[0],c[1]=e*a[1],c[2]=e*a[2],c[3]=Math.cos(d),this.onChange(),this}slerp(a,b){var c,d;let e,f,g,h,i,j,k,l,m,n,o,p,q;return c=this._target,d=this._target,j=d[0],k=d[1],l=d[2],m=d[3],n=a[0],o=a[1],(f=j*n+k*o+l*(p=a[2])+m*(q=a[3]))<0&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(g=Math.sin(e=Math.acos(f)),h=Math.sin((1-b)*e)/g,i=Math.sin(b*e)/g):(h=1-b,i=b),c[0]=h*j+i*n,c[1]=h*k+i*o,c[2]=h*l+i*p,c[3]=h*m+i*q,this.onChange(),this}fromArray(a,b=0){return this._target[0]=a[b],this._target[1]=a[b+1],this._target[2]=a[b+2],this._target[3]=a[b+3],this.onChange(),this}toArray(a=[],b=0){return a[b]=this[0],a[b+1]=this[1],a[b+2]=this[2],a[b+3]=this[3],a}}function D(a){let b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15];return(b*g-c*f)*(l*q-m*p)-(b*h-d*f)*(k*q-m*o)+(b*i-e*f)*(k*p-l*o)+(c*h-d*g)*(j*q-m*n)-(c*i-e*g)*(j*p-l*n)+(d*i-e*h)*(j*o-k*n)}function E(a,b,c){let d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a}function F(a,b){let c=b[0],d=b[1],e=b[2],f=b[4],g=b[5],h=b[6],i=b[8],j=b[9],k=b[10];return a[0]=Math.hypot(c,d,e),a[1]=Math.hypot(f,g,h),a[2]=Math.hypot(i,j,k),a}let G=(d=[1,1,1],function(a,b){F(d,b);let c=1/d[0],e=1/d[1],f=1/d[2],g=b[0]*c,h=b[1]*e,i=b[2]*f,j=b[4]*c,k=b[5]*e,l=b[6]*f,m=b[8]*c,n=b[9]*e,o=b[10]*f,p=g+k+o,q=0;return p>0?(q=2*Math.sqrt(p+1),a[3]=.25*q,a[0]=(l-n)/q,a[1]=(m-i)/q,a[2]=(h-j)/q):g>k&&g>o?(q=2*Math.sqrt(1+g-k-o),a[3]=(l-n)/q,a[0]=.25*q,a[1]=(h+j)/q,a[2]=(m+i)/q):k>o?(q=2*Math.sqrt(1+k-g-o),a[3]=(m-i)/q,a[0]=(h+j)/q,a[1]=.25*q,a[2]=(l+n)/q):(q=2*Math.sqrt(1+o-g-k),a[3]=(h-j)/q,a[0]=(m+i)/q,a[1]=(l+n)/q,a[2]=.25*q),a});function H(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a[9]=b[9]+c[9],a[10]=b[10]+c[10],a[11]=b[11]+c[11],a[12]=b[12]+c[12],a[13]=b[13]+c[13],a[14]=b[14]+c[14],a[15]=b[15]+c[15],a}function I(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a[9]=b[9]-c[9],a[10]=b[10]-c[10],a[11]=b[11]-c[11],a[12]=b[12]-c[12],a[13]=b[13]-c[13],a[14]=b[14]-c[14],a[15]=b[15]-c[15],a}class J extends Array{constructor(a=1,b=0,c=0,d=0,e=0,f=1,g=0,h=0,i=0,j=0,k=1,l=0,m=0,n=0,o=0,p=1){return super(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(a){this[12]=a}set y(a){this[13]=a}set z(a){this[14]=a}set w(a){this[15]=a}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return a.length?this.copy(a):(this[0]=a,this[1]=b,this[2]=c,this[3]=d,this[4]=e,this[5]=f,this[6]=g,this[7]=h,this[8]=i,this[9]=j,this[10]=k,this[11]=l,this[12]=m,this[13]=n,this[14]=o,this[15]=p,this)}translate(a,b=this){let c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;return o=a[0],p=a[1],q=a[2],b===this?(this[12]=b[0]*o+b[4]*p+b[8]*q+b[12],this[13]=b[1]*o+b[5]*p+b[9]*q+b[13],this[14]=b[2]*o+b[6]*p+b[10]*q+b[14],this[15]=b[3]*o+b[7]*p+b[11]*q+b[15]):(c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],this[0]=c,this[1]=d,this[2]=e,this[3]=f,this[4]=g,this[5]=h,this[6]=i,this[7]=j,this[8]=k,this[9]=l,this[10]=m,this[11]=n,this[12]=c*o+g*p+k*q+b[12],this[13]=d*o+h*p+l*q+b[13],this[14]=e*o+i*p+m*q+b[14],this[15]=f*o+j*p+n*q+b[15]),this}rotate(a,b,c=this){let d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;return B=b[0],1e-6>Math.abs(E=Math.hypot(B,C=b[1],D=b[2]))||(B*=E=1/E,C*=E,D*=E,d=Math.sin(a),f=1-(e=Math.cos(a)),g=c[0],h=c[1],i=c[2],j=c[3],k=c[4],l=c[5],m=c[6],n=c[7],o=c[8],p=c[9],q=c[10],r=c[11],s=B*B*f+e,t=C*B*f+D*d,u=D*B*f-C*d,v=B*C*f-D*d,w=C*C*f+e,x=D*C*f+B*d,y=B*D*f+C*d,z=C*D*f-B*d,A=D*D*f+e,this[0]=g*s+k*t+o*u,this[1]=h*s+l*t+p*u,this[2]=i*s+m*t+q*u,this[3]=j*s+n*t+r*u,this[4]=g*v+k*w+o*x,this[5]=h*v+l*w+p*x,this[6]=i*v+m*w+q*x,this[7]=j*v+n*w+r*x,this[8]=g*y+k*z+o*A,this[9]=h*y+l*z+p*A,this[10]=i*y+m*z+q*A,this[11]=j*y+n*z+r*A,c!==this&&(this[12]=c[12],this[13]=c[13],this[14]=c[14],this[15]=c[15])),this}scale(a,b=this){var c;let d,e,f;return d=(c="number"==typeof a?[a,a,a]:a)[0],e=c[1],f=c[2],this[0]=b[0]*d,this[1]=b[1]*d,this[2]=b[2]*d,this[3]=b[3]*d,this[4]=b[4]*e,this[5]=b[5]*e,this[6]=b[6]*e,this[7]=b[7]*e,this[8]=b[8]*f,this[9]=b[9]*f,this[10]=b[10]*f,this[11]=b[11]*f,this[12]=b[12],this[13]=b[13],this[14]=b[14],this[15]=b[15],this}add(a,b){return b?H(this,a,b):H(this,this,a),this}sub(a,b){return b?I(this,a,b):I(this,this,a),this}multiply(a,b){if(a.length)b?E(this,a,b):E(this,this,a);else this[0]=this[0]*a,this[1]=this[1]*a,this[2]=this[2]*a,this[3]=this[3]*a,this[4]=this[4]*a,this[5]=this[5]*a,this[6]=this[6]*a,this[7]=this[7]*a,this[8]=this[8]*a,this[9]=this[9]*a,this[10]=this[10]*a,this[11]=this[11]*a,this[12]=this[12]*a,this[13]=this[13]*a,this[14]=this[14]*a,this[15]=this[15]*a;return this}identity(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this}copy(a){return this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=a[3],this[4]=a[4],this[5]=a[5],this[6]=a[6],this[7]=a[7],this[8]=a[8],this[9]=a[9],this[10]=a[10],this[11]=a[11],this[12]=a[12],this[13]=a[13],this[14]=a[14],this[15]=a[15],this}fromPerspective({fov:a,aspect:b,near:c,far:d}={}){let e,f;return e=1/Math.tan(a/2),f=1/(c-d),this[0]=e/b,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=e,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=(d+c)*f,this[11]=-1,this[12]=0,this[13]=0,this[14]=2*d*c*f,this[15]=0,this}fromOrthogonal({left:a,right:b,bottom:c,top:d,near:e,far:f}){let g,h,i;return g=1/(a-b),h=1/(c-d),i=1/(e-f),this[0]=-2*g,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=-2*h,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=2*i,this[11]=0,this[12]=(a+b)*g,this[13]=(d+c)*h,this[14]=(f+e)*i,this[15]=1,this}fromQuaternion(a){let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;return b=a[0],c=a[1],d=a[2],e=a[3],f=b+b,g=c+c,h=d+d,i=b*f,j=c*f,k=c*g,l=d*f,m=d*g,n=d*h,o=e*f,p=e*g,q=e*h,this[0]=1-k-n,this[1]=j+q,this[2]=l-p,this[3]=0,this[4]=j-q,this[5]=1-i-n,this[6]=m+o,this[7]=0,this[8]=l+p,this[9]=m-o,this[10]=1-i-k,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this}setPosition(a){return this.x=a[0],this.y=a[1],this.z=a[2],this}inverse(a=this){let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;return b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,(D=r*(C=l*q-m*p)-s*B+t*A+u*z-v*y+w*x)&&(D=1/D,this[0]=(g*C-h*B+i*A)*D,this[1]=(d*B-c*C-e*A)*D,this[2]=(o*w-p*v+q*u)*D,this[3]=(l*v-k*w-m*u)*D,this[4]=(h*z-f*C-i*y)*D,this[5]=(b*C-d*z+e*y)*D,this[6]=(p*t-n*w-q*s)*D,this[7]=(j*w-l*t+m*s)*D,this[8]=(f*B-g*z+i*x)*D,this[9]=(c*z-b*B-e*x)*D,this[10]=(n*v-o*t+q*r)*D,this[11]=(k*t-j*v-m*r)*D,this[12]=(g*y-f*A-h*x)*D,this[13]=(b*A-c*y+d*x)*D,this[14]=(o*s-n*u-p*r)*D,this[15]=(j*u-k*s+l*r)*D),this}compose(a,b,c){let d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;return d=a[0],e=a[1],f=a[2],g=a[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j,t=c[0],u=c[1],v=c[2],this[0]=(1-(n+p))*t,this[1]=(l+s)*t,this[2]=(m-r)*t,this[3]=0,this[4]=(l-s)*u,this[5]=(1-(k+p))*u,this[6]=(o+q)*u,this[7]=0,this[8]=(m+r)*v,this[9]=(o-q)*v,this[10]=(1-(k+n))*v,this[11]=0,this[12]=b[0],this[13]=b[1],this[14]=b[2],this[15]=1,this}decompose(a,b,c){let d,e,g,h,i,j,k;return d=f([this[0],this[1],this[2]]),e=f([this[4],this[5],this[6]]),g=f([this[8],this[9],this[10]]),0>D(this)&&(d=-d),b[0]=this[12],b[1]=this[13],b[2]=this[14],h=this.slice(),i=1/d,j=1/e,k=1/g,h[0]*=i,h[1]*=i,h[2]*=i,h[4]*=j,h[5]*=j,h[6]*=j,h[8]*=k,h[9]*=k,h[10]*=k,G(a,h),c[0]=d,c[1]=e,c[2]=g,this}getRotation(a){return G(a,this),this}getTranslation(a){return a[0]=this[12],a[1]=this[13],a[2]=this[14],this}getScaling(a){return F(a,this),this}getMaxScaleOnAxis(){let a,b,c,d,e,f,g,h,i;return a=this[0],b=this[1],c=this[2],d=this[4],e=this[5],f=this[6],g=this[8],Math.sqrt(Math.max(a*a+b*b+c*c,d*d+e*e+f*f,g*g+(h=this[9])*h+(i=this[10])*i))}lookAt(a,b,c){let d,e,f,g,h,i,j,k,l,m,n,o,p;return d=a[0],e=a[1],f=a[2],g=c[0],h=c[1],i=c[2],j=d-b[0],0==(m=j*j+(k=e-b[1])*k+(l=f-b[2])*l)?l=1:(j*=m=1/Math.sqrt(m),k*=m,l*=m),0==(m=(n=h*l-i*k)*n+(o=i*j-g*l)*o+(p=g*k-h*j)*p)&&(i?g+=1e-6:h?i+=1e-6:h+=1e-6,m=(n=h*l-i*k)*n+(o=i*j-g*l)*o+(p=g*k-h*j)*p),n*=m=1/Math.sqrt(m),o*=m,p*=m,this[0]=n,this[1]=o,this[2]=p,this[3]=0,this[4]=k*p-l*o,this[5]=l*n-j*p,this[6]=j*o-k*n,this[7]=0,this[8]=j,this[9]=k,this[10]=l,this[11]=0,this[12]=d,this[13]=e,this[14]=f,this[15]=1,this}determinant(){return D(this)}fromArray(a,b=0){return this[0]=a[b],this[1]=a[b+1],this[2]=a[b+2],this[3]=a[b+3],this[4]=a[b+4],this[5]=a[b+5],this[6]=a[b+6],this[7]=a[b+7],this[8]=a[b+8],this[9]=a[b+9],this[10]=a[b+10],this[11]=a[b+11],this[12]=a[b+12],this[13]=a[b+13],this[14]=a[b+14],this[15]=a[b+15],this}toArray(a=[],b=0){return a[b]=this[0],a[b+1]=this[1],a[b+2]=this[2],a[b+3]=this[3],a[b+4]=this[4],a[b+5]=this[5],a[b+6]=this[6],a[b+7]=this[7],a[b+8]=this[8],a[b+9]=this[9],a[b+10]=this[10],a[b+11]=this[11],a[b+12]=this[12],a[b+13]=this[13],a[b+14]=this[14],a[b+15]=this[15],a}}let K=new J;class L extends Array{constructor(a=0,b=a,c=a,d="YXZ"){super(a,b,c),this.order=d,this.onChange=()=>{},this._target=this;const e=["0","1","2"];return new Proxy(this,{set(a,b){let c=Reflect.set(...arguments);return c&&e.includes(b)&&a.onChange(),c}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(a){this._target[0]=a,this.onChange()}set y(a){this._target[1]=a,this.onChange()}set z(a){this._target[2]=a,this.onChange()}set(a,b=a,c=a){return a.length?this.copy(a):(this._target[0]=a,this._target[1]=b,this._target[2]=c,this.onChange(),this)}copy(a){return this._target[0]=a[0],this._target[1]=a[1],this._target[2]=a[2],this.onChange(),this}reorder(a){return this._target.order=a,this.onChange(),this}fromRotationMatrix(a,b=this.order){return!function(a,b,c="YXZ"){"XYZ"===c?(a[1]=Math.asin(Math.min(Math.max(b[8],-1),1)),.99999>Math.abs(b[8])?(a[0]=Math.atan2(-b[9],b[10]),a[2]=Math.atan2(-b[4],b[0])):(a[0]=Math.atan2(b[6],b[5]),a[2]=0)):"YXZ"===c?(a[0]=Math.asin(-Math.min(Math.max(b[9],-1),1)),.99999>Math.abs(b[9])?(a[1]=Math.atan2(b[8],b[10]),a[2]=Math.atan2(b[1],b[5])):(a[1]=Math.atan2(-b[2],b[0]),a[2]=0)):"ZXY"===c?(a[0]=Math.asin(Math.min(Math.max(b[6],-1),1)),.99999>Math.abs(b[6])?(a[1]=Math.atan2(-b[2],b[10]),a[2]=Math.atan2(-b[4],b[5])):(a[1]=0,a[2]=Math.atan2(b[1],b[0]))):"ZYX"===c?(a[1]=Math.asin(-Math.min(Math.max(b[2],-1),1)),.99999>Math.abs(b[2])?(a[0]=Math.atan2(b[6],b[10]),a[2]=Math.atan2(b[1],b[0])):(a[0]=0,a[2]=Math.atan2(-b[4],b[5]))):"YZX"===c?(a[2]=Math.asin(Math.min(Math.max(b[1],-1),1)),.99999>Math.abs(b[1])?(a[0]=Math.atan2(-b[9],b[5]),a[1]=Math.atan2(-b[2],b[0])):(a[0]=0,a[1]=Math.atan2(b[8],b[10]))):"XZY"===c&&(a[2]=Math.asin(-Math.min(Math.max(b[4],-1),1)),.99999>Math.abs(b[4])?(a[0]=Math.atan2(b[6],b[5]),a[1]=Math.atan2(b[8],b[0])):(a[0]=Math.atan2(-b[9],b[10]),a[1]=0))}(this._target,a,b),this.onChange(),this}fromQuaternion(a,b=this.order,c){return K.fromQuaternion(a),this._target.fromRotationMatrix(K,b),c||this.onChange(),this}fromArray(a,b=0){return this._target[0]=a[b],this._target[1]=a[b+1],this._target[2]=a[b+2],this}toArray(a=[],b=0){return a[b]=this[0],a[b+1]=this[1],a[b+2]=this[2],a}}class M{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new J,this.worldMatrix=new J,this.matrixAutoUpdate=!0,this.worldMatrixNeedsUpdate=!1,this.position=new p,this.quaternion=new C,this.scale=new p(1),this.rotation=new L,this.up=new p(0,1,0),this.rotation._target.onChange=()=>this.quaternion.fromEuler(this.rotation,!0),this.quaternion._target.onChange=()=>this.rotation.fromQuaternion(this.quaternion,void 0,!0)}setParent(a,b=!0){this.parent&&a!==this.parent&&this.parent.removeChild(this,!1),this.parent=a,b&&a&&a.addChild(this,!1)}addChild(a,b=!0){~this.children.indexOf(a)||this.children.push(a),b&&a.setParent(this,!1)}removeChild(a,b=!0){~this.children.indexOf(a)&&this.children.splice(this.children.indexOf(a),1),b&&a.setParent(null,!1)}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||a)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,a=!0);for(let b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(a){if(!a(this))for(let b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)}decompose(){this.matrix.decompose(this.quaternion._target,this.position,this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(a,b=!1){b?this.matrix.lookAt(this.position,a,this.up):this.matrix.lookAt(a,this.position,this.up),this.matrix.getRotation(this.quaternion._target),this.rotation.fromQuaternion(this.quaternion)}}function N(a,b,c){let d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a}class O extends Array{constructor(a=1,b=0,c=0,d=0,e=1,f=0,g=0,h=0,i=1){return super(a,b,c,d,e,f,g,h,i),this}set(a,b,c,d,e,f,g,h,i){return a.length?this.copy(a):(this[0]=a,this[1]=b,this[2]=c,this[3]=d,this[4]=e,this[5]=f,this[6]=g,this[7]=h,this[8]=i,this)}translate(a,b=this){let c,d,e,f,g,h,i,j,k,l,m;return c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=a[0],m=a[1],this[0]=c,this[1]=d,this[2]=e,this[3]=f,this[4]=g,this[5]=h,this[6]=l*c+m*f+i,this[7]=l*d+m*g+j,this[8]=l*e+m*h+k,this}rotate(a,b=this){let c,d,e,f,g,h,i,j,k,l,m;return c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=Math.sin(a),m=Math.cos(a),this[0]=m*c+l*f,this[1]=m*d+l*g,this[2]=m*e+l*h,this[3]=m*f-l*c,this[4]=m*g-l*d,this[5]=m*h-l*e,this[6]=i,this[7]=j,this[8]=k,this}scale(a,b=this){let c,d;return c=a[0],d=a[1],this[0]=c*b[0],this[1]=c*b[1],this[2]=c*b[2],this[3]=d*b[3],this[4]=d*b[4],this[5]=d*b[5],this[6]=b[6],this[7]=b[7],this[8]=b[8],this}multiply(a,b){return b?N(this,a,b):N(this,this,a),this}identity(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=1,this[5]=0,this[6]=0,this[7]=0,this[8]=1,this}copy(a){return this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=a[3],this[4]=a[4],this[5]=a[5],this[6]=a[6],this[7]=a[7],this[8]=a[8],this}fromMatrix4(a){return this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=a[4],this[4]=a[5],this[5]=a[6],this[6]=a[8],this[7]=a[9],this[8]=a[10],this}fromQuaternion(a){let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;return b=a[0],c=a[1],d=a[2],e=a[3],f=b+b,g=c+c,h=d+d,i=b*f,j=c*f,k=c*g,l=d*f,m=d*g,n=d*h,o=e*f,p=e*g,q=e*h,this[0]=1-k-n,this[3]=j-q,this[6]=l+p,this[1]=j+q,this[4]=1-i-n,this[7]=m-o,this[2]=l-p,this[5]=m+o,this[8]=1-i-k,this}fromBasis(a,b,c){return this.set(a[0],a[1],a[2],b[0],b[1],b[2],c[0],c[1],c[2]),this}inverse(a=this){let b,c,d,e,f,g,h,i,j,k,l,m,n;return b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],(n=b*(k=(j=a[8])*f-g*i)+c*(l=-j*e+g*h)+d*(m=i*e-f*h))&&(n=1/n,this[0]=k*n,this[1]=(-j*c+d*i)*n,this[2]=(g*c-d*f)*n,this[3]=l*n,this[4]=(j*b-d*h)*n,this[5]=(-g*b+d*e)*n,this[6]=m*n,this[7]=(-i*b+c*h)*n,this[8]=(f*b-c*e)*n),this}getNormalMatrix(a){let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;return b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,(D=r*(C=l*q-m*p)-s*B+t*A+u*z-v*y+w*x)&&(D=1/D,this[0]=(g*C-h*B+i*A)*D,this[1]=(h*z-f*C-i*y)*D,this[2]=(f*B-g*z+i*x)*D,this[3]=(d*B-c*C-e*A)*D,this[4]=(b*C-d*z+e*y)*D,this[5]=(c*z-b*B-e*x)*D,this[6]=(o*w-p*v+q*u)*D,this[7]=(p*t-n*w-q*s)*D,this[8]=(n*v-o*t+q*r)*D),this}}let P=0;class Q extends M{constructor(a,{geometry:b,program:c,mode:d=a.TRIANGLES,frustumCulled:e=!0,renderOrder:f=0}={}){super(),a.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=a,this.id=P++,this.geometry=b,this.program=c,this.mode=d,this.frustumCulled=e,this.renderOrder=f,this.modelViewMatrix=new J,this.normalMatrix=new O,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(a){return this.beforeRenderCallbacks.push(a),this}onAfterRender(a){return this.afterRenderCallbacks.push(a),this}draw({camera:a}={}){a&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=a.projectionMatrix,this.program.uniforms.cameraPosition.value=a.worldPosition,this.program.uniforms.viewMatrix.value=a.viewMatrix,this.modelViewMatrix.multiply(a.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix),this.beforeRenderCallbacks.forEach(b=>b&&b({mesh:this,camera:a}));let b=this.program.cullFace&&0>this.worldMatrix.determinant();this.program.use({flipFaces:b}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(b=>b&&b({mesh:this,camera:a}))}}let R={black:"#000000",white:"#ffffff",red:"#ff0000",green:"#00ff00",blue:"#0000ff",fuchsia:"#ff00ff",cyan:"#00ffff",yellow:"#ffff00",orange:"#ff8000"};function S(a){4===a.length&&(a=a[0]+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]);let b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b||console.warn(`Unable to convert hex string ${a} to rgb values`),[parseInt(b[1],16)/255,parseInt(b[2],16)/255,parseInt(b[3],16)/255]}function T(a){if(void 0===a)return[0,0,0];if(3==arguments.length)return arguments;if(!isNaN(a)){var b;return[((b=parseInt(b=a))>>16&255)/255,(b>>8&255)/255,(255&b)/255]}return"#"===a[0]?S(a):R[a.toLowerCase()]?S(R[a.toLowerCase()]):(console.warn("Color format not recognised"),[0,0,0])}class U extends Array{constructor(a){if(Array.isArray(a))return super(...a);return super(...T(...arguments))}get r(){return this[0]}get g(){return this[1]}get b(){return this[2]}set r(a){this[0]=a}set g(a){this[1]=a}set b(a){this[2]=a}set(a){return Array.isArray(a)?this.copy(a):this.copy(T(...arguments))}copy(a){return this[0]=a[0],this[1]=a[1],this[2]=a[2],this}}let V=new p,W=1,X=1,Y=!1;class Z{constructor(a,b={}){for(let c in a.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=a,this.attributes=b,this.id=W++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state,b)this.addAttribute(c,b[c])}addAttribute(a,b){if(this.attributes[a]=b,b.id=X++,b.size=b.size||1,b.type=b.type||(b.data.constructor===Float32Array?this.gl.FLOAT:b.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),b.target="index"===a?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,b.normalized=b.normalized||!1,b.stride=b.stride||0,b.offset=b.offset||0,b.count=b.count||(b.stride?b.data.byteLength/b.stride:b.data.length/b.size),b.divisor=b.instanced||0,b.needsUpdate=!1,b.usage=b.usage||this.gl.STATIC_DRAW,b.buffer||this.updateAttribute(b),b.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==b.count*b.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,b.count*b.divisor);this.instancedCount=b.count*b.divisor}else"index"===a?this.drawRange.count=b.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,b.count))}updateAttribute(a){let b=!a.buffer;b&&(a.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==a.buffer&&(this.gl.bindBuffer(a.target,a.buffer),this.glState.boundBuffer=a.buffer),b?this.gl.bufferData(a.target,a.data,a.usage):this.gl.bufferSubData(a.target,0,a.data),a.needsUpdate=!1}setIndex(a){this.addAttribute("index",a)}setDrawRange(a,b){this.drawRange.start=a,this.drawRange.count=b}setInstancedCount(a){this.instancedCount=a}createVAO(a){this.VAOs[a.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[a.attributeOrder]),this.bindAttributes(a)}bindAttributes(a){a.attributeLocations.forEach((a,{name:b,type:c})=>{if(!this.attributes[b])return void console.warn(`active attribute ${b} not being supplied`);let d=this.attributes[b];this.gl.bindBuffer(d.target,d.buffer),this.glState.boundBuffer=d.buffer;let e=1;35674===c&&(e=2),35675===c&&(e=3),35676===c&&(e=4);let f=d.size/e,g=1===e?0:e*e*4,h=1===e?0:4*e;for(let b=0;b<e;b++)this.gl.vertexAttribPointer(a+b,f,d.type,d.normalized,d.stride+g,d.offset+b*h),this.gl.enableVertexAttribArray(a+b),this.gl.renderer.vertexAttribDivisor(a+b,d.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:a,mode:b=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${a.attributeOrder}`&&(this.VAOs[a.attributeOrder]||this.createVAO(a),this.gl.renderer.bindVertexArray(this.VAOs[a.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${a.attributeOrder}`),a.attributeLocations.forEach((a,{name:b})=>{let c=this.attributes[b];c.needsUpdate&&this.updateAttribute(c)});let c=2;this.attributes.index?.type===this.gl.UNSIGNED_INT&&(c=4),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(b,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*c,this.instancedCount):this.gl.renderer.drawArraysInstanced(b,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(b,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*c):this.gl.drawArrays(b,this.drawRange.start,this.drawRange.count)}getPosition(){let a=this.attributes.position;return a.data?a:Y?void 0:(console.warn("No position buffer data found to compute bounds"),Y=!0)}computeBoundingBox(a){a||(a=this.getPosition());let b=a.data,c=a.size;this.bounds||(this.bounds={min:new p,max:new p,center:new p,scale:new p,radius:1/0});let d=this.bounds.min,e=this.bounds.max,f=this.bounds.center,g=this.bounds.scale;d.set(Infinity),e.set(-1/0);for(let a=0,f=b.length;a<f;a+=c){let c=b[a],f=b[a+1],g=b[a+2];d.x=Math.min(c,d.x),d.y=Math.min(f,d.y),d.z=Math.min(g,d.z),e.x=Math.max(c,e.x),e.y=Math.max(f,e.y),e.z=Math.max(g,e.z)}g.sub(e,d),f.add(d,e).divide(2)}computeBoundingSphere(a){a||(a=this.getPosition());let b=a.data,c=a.size;this.bounds||this.computeBoundingBox(a);let d=0;for(let a=0,e=b.length;a<e;a+=c)V.fromArray(b,a),d=Math.max(d,this.bounds.center.squaredDistance(V));this.bounds.radius=Math.sqrt(d)}remove(){for(let a in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[a]),delete this.VAOs[a];for(let a in this.attributes)this.gl.deleteBuffer(this.attributes[a].buffer),delete this.attributes[a]}}class $ extends Z{constructor(a,{attributes:b={}}={}){Object.assign(b,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),super(a,b)}}var _=a.i(72131);let aa=`
attribute vec2 position;
attribute vec2 uv;
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 0.0, 1.0);
}
`,ab=`
precision mediump float;

varying vec2 vUv;

uniform float iTime;
uniform vec3  iResolution;
uniform float uScale;

uniform vec2  uGridMul;
uniform float uDigitSize;
uniform float uScanlineIntensity;
uniform float uGlitchAmount;
uniform float uFlickerAmount;
uniform float uNoiseAmp;
uniform float uChromaticAberration;
uniform float uDither;
uniform float uCurvature;
uniform vec3  uTint;
uniform vec2  uMouse;
uniform float uMouseStrength;
uniform float uUseMouse;
uniform float uPageLoadProgress;
uniform float uUsePageLoadAnimation;
uniform float uBrightness;

float time;

float hash21(vec2 p){
  p = fract(p * 234.56);
  p += dot(p, p + 34.56);
  return fract(p.x * p.y);
}

float noise(vec2 p)
{
  return sin(p.x * 10.0) * sin(p.y * (3.0 + sin(time * 0.090909))) + 0.2;
}

mat2 rotate(float angle)
{
  float c = cos(angle);
  float s = sin(angle);
  return mat2(c, -s, s, c);
}

float fbm(vec2 p)
{
  p *= 1.1;
  float f = 0.0;
  float amp = 0.5 * uNoiseAmp;

  mat2 modify0 = rotate(time * 0.02);
  f += amp * noise(p);
  p = modify0 * p * 2.0;
  amp *= 0.454545;

  mat2 modify1 = rotate(time * 0.02);
  f += amp * noise(p);
  p = modify1 * p * 2.0;
  amp *= 0.454545;

  mat2 modify2 = rotate(time * 0.08);
  f += amp * noise(p);

  return f;
}

float pattern(vec2 p, out vec2 q, out vec2 r) {
  vec2 offset1 = vec2(1.0);
  vec2 offset0 = vec2(0.0);
  mat2 rot01 = rotate(0.1 * time);
  mat2 rot1 = rotate(0.1);

  q = vec2(fbm(p + offset1), fbm(rot01 * p + offset1));
  r = vec2(fbm(rot1 * q + offset0), fbm(q + offset0));
  return fbm(p + r);
}

float digit(vec2 p){
    vec2 grid = uGridMul * 15.0;
    vec2 s = floor(p * grid) / grid;
    p = p * grid;
    vec2 q, r;
    float intensity = pattern(s * 0.1, q, r) * 1.3 - 0.03;

    if(uUseMouse > 0.5){
        vec2 mouseWorld = uMouse * uScale;
        float distToMouse = distance(s, mouseWorld);
        float mouseInfluence = exp(-distToMouse * 8.0) * uMouseStrength * 10.0;
        intensity += mouseInfluence;

        float ripple = sin(distToMouse * 20.0 - iTime * 5.0) * 0.1 * mouseInfluence;
        intensity += ripple;
    }

    if(uUsePageLoadAnimation > 0.5){
        float cellRandom = fract(sin(dot(s, vec2(12.9898, 78.233))) * 43758.5453);
        float cellDelay = cellRandom * 0.8;
        float cellProgress = clamp((uPageLoadProgress - cellDelay) / 0.2, 0.0, 1.0);

        float fadeAlpha = smoothstep(0.0, 1.0, cellProgress);
        intensity *= fadeAlpha;
    }

    p = fract(p);
    p *= uDigitSize;

    float px5 = p.x * 5.0;
    float py5 = (1.0 - p.y) * 5.0;
    float x = fract(px5);
    float y = fract(py5);

    float i = floor(py5) - 2.0;
    float j = floor(px5) - 2.0;
    float n = i * i + j * j;
    float f = n * 0.0625;

    float isOn = step(0.1, intensity - f);
    float brightness = isOn * (0.2 + y * 0.8) * (0.75 + x * 0.25);

    return step(0.0, p.x) * step(p.x, 1.0) * step(0.0, p.y) * step(p.y, 1.0) * brightness;
}

float onOff(float a, float b, float c)
{
  return step(c, sin(iTime + a * cos(iTime * b))) * uFlickerAmount;
}

float displace(vec2 look)
{
    float y = look.y - mod(iTime * 0.25, 1.0);
    float window = 1.0 / (1.0 + 50.0 * y * y);
    return sin(look.y * 20.0 + iTime) * 0.0125 * onOff(4.0, 2.0, 0.8) * (1.0 + cos(iTime * 60.0)) * window;
}

vec3 getColor(vec2 p){

    float bar = step(mod(p.y + time * 20.0, 1.0), 0.2) * 0.4 + 1.0;
    bar *= uScanlineIntensity;

    float displacement = displace(p);
    p.x += displacement;

    if (uGlitchAmount != 1.0) {
      float extra = displacement * (uGlitchAmount - 1.0);
      p.x += extra;
    }

    float middle = digit(p);

    const float off = 0.002;
    float sum = digit(p + vec2(-off, -off)) + digit(p + vec2(0.0, -off)) + digit(p + vec2(off, -off)) +
                digit(p + vec2(-off, 0.0)) + digit(p + vec2(0.0, 0.0)) + digit(p + vec2(off, 0.0)) +
                digit(p + vec2(-off, off)) + digit(p + vec2(0.0, off)) + digit(p + vec2(off, off));

    vec3 baseColor = vec3(0.9) * middle + sum * 0.1 * vec3(1.0) * bar;
    return baseColor;
}

vec2 barrel(vec2 uv){
  vec2 c = uv * 2.0 - 1.0;
  float r2 = dot(c, c);
  c *= 1.0 + uCurvature * r2;
  return c * 0.5 + 0.5;
}

void main() {
    time = iTime * 0.333333;
    vec2 uv = vUv;

    if(uCurvature != 0.0){
      uv = barrel(uv);
    }

    vec2 p = uv * uScale;
    vec3 col = getColor(p);

    if(uChromaticAberration != 0.0){
      vec2 ca = vec2(uChromaticAberration) / iResolution.xy;
      col.r = getColor(p + ca).r;
      col.b = getColor(p - ca).b;
    }

    col *= uTint;
    col *= uBrightness;

    if(uDither > 0.0){
      float rnd = hash21(gl_FragCoord.xy);
      col += (rnd - 0.5) * (uDither * 0.003922);
    }

    gl_FragColor = vec4(col, 1.0);
}
`;function ac({scale:a=1,gridMul:b=[2,1],digitSize:c=1.5,timeScale:d=.3,pause:f=!1,scanlineIntensity:g=.3,glitchAmount:h=1,flickerAmount:i=1,noiseAmp:j=0,chromaticAberration:k=0,dither:l=0,curvature:m=.2,tint:n="#ffffff",mouseReact:o=!0,mouseStrength:p=.2,dpr:q=1,pageLoadAnimation:r=!0,brightness:t=1,className:u="",style:w}){let x=(0,_.useRef)(null),y=(0,_.useRef)(null),z=(0,_.useRef)(null),A=(0,_.useRef)({x:.5,y:.5}),B=(0,_.useRef)({x:.5,y:.5}),C=(0,_.useRef)(0),D=(0,_.useRef)(0),E=(0,_.useRef)(0),F=(0,_.useRef)(100*Math.random()),G=(0,_.useMemo)(()=>{let a,b;return 3===(a=n.replace("#","").trim()).length&&(a=a.split("").map(a=>a+a).join("")),[((b=parseInt(a,16))>>16&255)/255,(b>>8&255)/255,(255&b)/255]},[n]),H=(0,_.useMemo)(()=>"boolean"==typeof l?+!!l:l,[l]),I=(0,_.useCallback)(a=>{A.current={x:a.clientX/window.innerWidth,y:1-a.clientY/window.innerHeight}},[]);return(0,_.useEffect)(()=>{let e=x.current;if(!e)return;let l=new s({dpr:q});z.current=l;let n=l.gl;n.clearColor(0,0,0,1);let u=new $(n),w=new v(n,{vertex:aa,fragment:ab,uniforms:{iTime:{value:0},iResolution:{value:new U(n.canvas.width,n.canvas.height,n.canvas.width/n.canvas.height)},uScale:{value:a},uGridMul:{value:new Float32Array(b)},uDigitSize:{value:c},uScanlineIntensity:{value:g},uGlitchAmount:{value:h},uFlickerAmount:{value:i},uNoiseAmp:{value:j},uChromaticAberration:{value:k},uDither:{value:H},uCurvature:{value:m},uTint:{value:new U(G[0],G[1],G[2])},uMouse:{value:new Float32Array([B.current.x,B.current.y])},uMouseStrength:{value:p},uUseMouse:{value:+!!o},uPageLoadProgress:{value:+!r},uUsePageLoadAnimation:{value:+!!r},uBrightness:{value:t}}});y.current=w;let J=new Q(n,{geometry:u,program:w});function K(){e&&l&&(l.setSize(e.offsetWidth,e.offsetHeight),w.uniforms.iResolution.value=new U(n.canvas.width,n.canvas.height,n.canvas.width/n.canvas.height))}let L=new ResizeObserver(()=>K());L.observe(e),K();let M=a=>{if(D.current=requestAnimationFrame(M),r&&0===E.current&&(E.current=a),f)w.uniforms.iTime.value=C.current;else{let b=(.001*a+F.current)*d;w.uniforms.iTime.value=b,C.current=b}if(r&&E.current>0){let b=Math.min((a-E.current)/2e3,1);w.uniforms.uPageLoadProgress.value=b}if(o){let a=B.current,b=A.current;a.x+=(b.x-a.x)*.08,a.y+=(b.y-a.y)*.08;let c=w.uniforms.uMouse.value;c[0]=a.x,c[1]=a.y}l.render({scene:J})};return D.current=requestAnimationFrame(M),e.appendChild(n.canvas),o&&window.addEventListener("mousemove",I),()=>{cancelAnimationFrame(D.current),L.disconnect(),o&&window.removeEventListener("mousemove",I),n.canvas.parentElement===e&&e.removeChild(n.canvas),n.getExtension("WEBGL_lose_context")?.loseContext(),E.current=0,F.current=100*Math.random()}},[q,f,d,a,b,c,g,h,i,j,k,H,m,G,o,p,r,t,I]),(0,e.jsx)("div",{ref:x,className:`faulty-terminal-container ${u}`,style:w})}a.s(["FaultyTerminal",()=>ac],22575)}];

//# sourceMappingURL=_995d20ef._.js.map